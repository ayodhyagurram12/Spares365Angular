{"version":3,"file":"ngx-translate-messageformat-compiler.js","sources":["ng://ngx-translate-messageformat-compiler/lib/message-format-config.ts","ng://ngx-translate-messageformat-compiler/lib/translate-message-format-compiler.ts","ng://ngx-translate-messageformat-compiler/lib/translate-message-format-debug-compiler.ts","ng://ngx-translate-messageformat-compiler/public-api.ts","ng://ngx-translate-messageformat-compiler/ngx-translate-messageformat-compiler.ts"],"sourcesContent":["import { InjectionToken } from \"@angular/core\";\n\nexport const MESSAGE_FORMAT_CONFIG = new InjectionToken<MessageFormatConfig>(\n  \"MESSAGE_FORMAT_CONFIG\"\n);\n\nexport interface MessageFormatConfig {\n  biDiSupport?: boolean;\n  formatters?: {\n    [name: string]: (val: any, lc: string, arg?: string) => string;\n  };\n  locales?: string | string[];\n  strictNumberSign?: boolean;\n  disablePluralKeyChecks?: boolean;\n}\n\nexport const defaultConfig: MessageFormatConfig = {\n  biDiSupport: false,\n  formatters: undefined,\n  locales: undefined,\n  strictNumberSign: false,\n  disablePluralKeyChecks: false,\n};\n","import { Inject, Injectable, Optional } from \"@angular/core\";\nimport { TranslateCompiler } from \"@ngx-translate/core\";\nimport * as MessageFormat from \"messageformat\";\nimport {\n  defaultConfig,\n  MessageFormatConfig,\n  MESSAGE_FORMAT_CONFIG,\n} from \"./message-format-config\";\n\n/**\n * This compiler expects ICU syntax and compiles the expressions with messageformat.js\n */\n@Injectable()\nexport class TranslateMessageFormatCompiler extends TranslateCompiler {\n  private messageFormat: MessageFormat;\n\n  constructor(\n    @Optional()\n    @Inject(MESSAGE_FORMAT_CONFIG)\n    config?: MessageFormatConfig\n  ) {\n    super();\n\n    const {\n      locales,\n      formatters,\n      biDiSupport,\n      strictNumberSign,\n      disablePluralKeyChecks,\n    } = {\n      ...defaultConfig,\n      ...config,\n    };\n\n    this.messageFormat = new MessageFormat(locales);\n\n    if (formatters) {\n      this.messageFormat.addFormatters(formatters);\n    }\n    if (biDiSupport) {\n      this.messageFormat.setBiDiSupport(biDiSupport);\n    }\n    if (strictNumberSign) {\n      this.messageFormat.setStrictNumberSign(strictNumberSign);\n    }\n    if (disablePluralKeyChecks) {\n      this.messageFormat.disablePluralKeyChecks();\n    }\n  }\n\n  public compile(value: string, lang: string): (params: any) => string {\n    return this.messageFormat.compile(value, lang);\n  }\n\n  public compileTranslations(translations: any, lang: string): any {\n    return this.messageFormat.compile(translations, lang);\n  }\n}\n","import { Injectable } from \"@angular/core\";\nimport { TranslateMessageFormatCompiler } from \"./translate-message-format-compiler\";\n\n/* tslint:disable-next-line no-console */\nconst log = (...message: string[]) => console.log(tag, ...message);\nconst tag = \"[TranslateMessageFormatCompiler]\";\n\n@Injectable()\nexport class TranslateMessageFormatDebugCompiler extends TranslateMessageFormatCompiler {\n  public compile(value: string, lang: string): (params: any) => string {\n    log(`COMPILE (${lang})`, value);\n    const interpolationFn = super.compile(value, lang);\n\n    return this.wrap(interpolationFn, value);\n  }\n\n  public compileTranslations(value: any, lang: string): any {\n    log(`COMPILE (${lang})`, value);\n    const { toString, ...interpolationFns } = super.compileTranslations(\n      value,\n      lang\n    );\n\n    return { toString, ...this.wrapRecursively(interpolationFns, value) };\n  }\n\n  private wrap(\n    fn: (params: any) => string,\n    reference: string\n  ): (params: any) => string {\n    return (params: any) => {\n      log(\"INTERPOLATE\", reference, params);\n      return fn(params);\n    };\n  }\n\n  private wrapRecursively(obj: any, referenceObj: any): any {\n    return Object.keys(obj).reduce((acc: any, key: string) => {\n      const value = obj[key];\n      const referenceValue = referenceObj[key];\n\n      return typeof value === \"function\"\n        ? { ...acc, [key]: this.wrap(value, referenceValue) }\n        : { ...acc, [key]: this.wrapRecursively(value, referenceValue) };\n    }, {});\n  }\n}\n","/*\n * Public API Surface of ngx-translate-messageformat-compiler\n */\n\nexport * from \"./lib/message-format-config\";\nexport * from \"./lib/translate-message-format-compiler\";\nexport * from \"./lib/translate-message-format-debug-compiler\";\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}